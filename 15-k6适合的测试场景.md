# 第15章：k6 适合的测试场景

## 15.1 负载测试（Load Testing）

### 定义

负载测试是模拟正常预期负载，验证系统在正常负载下的性能表现。

### k6 配置

```javascript
export const options = {
  vus: 100,           // 100 个虚拟用户
  duration: '10m',    // 持续 10 分钟
};
```

### 适用场景

- 验证系统在预期负载下的表现
- 确定系统的正常容量
- 基线性能测试

## 15.2 压力测试（Stress Testing）

### 定义

压力测试是逐步增加负载，找到系统的性能极限。

### k6 配置

```javascript
export const options = {
  stages: [
    { duration: '2m', target: 100 },   // 2分钟增加到100用户
    { duration: '5m', target: 200 },   // 5分钟增加到200用户
    { duration: '5m', target: 300 },   // 5分钟增加到300用户
    { duration: '2m', target: 0 },     // 2分钟减少到0
  ],
};
```

### 适用场景

- 找到系统性能瓶颈
- 确定系统最大容量
- 验证系统在极限负载下的稳定性

## 15.3 峰值测试（Spike Testing）

### 定义

峰值测试是模拟突然的流量激增，测试系统应对突发流量的能力。

### k6 配置

```javascript
export const options = {
  stages: [
    { duration: '1m', target: 10 },    // 正常负载：10用户
    { duration: '10s', target: 500 },  // 突然激增到500用户
    { duration: '30s', target: 500 },  // 保持500用户30秒
    { duration: '10s', target: 10 },   // 快速回落到10用户
  ],
};
```

### 适用场景

- 测试系统应对突发流量的能力
- 验证限流和熔断机制
- 模拟促销活动场景

## 15.4 浸泡测试（Soak Testing）

### 定义

浸泡测试是长时间运行测试，发现内存泄漏、资源泄漏等问题。

### k6 配置

```javascript
export const options = {
  vus: 50,
  duration: '2h',    // 持续 2 小时
};
```

### 适用场景

- 发现内存泄漏
- 发现资源泄漏
- 验证系统长时间运行的稳定性

## 15.5 容量测试（Capacity Testing）

### 定义

容量测试是确定系统在保持可接受性能的前提下，能够处理的最大负载。

### k6 配置

```javascript
export const options = {
  stages: [
    { duration: '5m', target: 100 },
    { duration: '10m', target: 200 },
    { duration: '10m', target: 300 },
    { duration: '10m', target: 400 },
    // 逐步增加，直到性能下降
  ],
  thresholds: {
    http_req_duration: ['p(95)<1000'],  // 性能阈值
  },
};
```

### 适用场景

- 容量规划
- 资源需求评估
- 扩容决策

## 15.6 烟雾测试（Smoke Testing）

### 定义

烟雾测试是快速验证系统基本功能是否正常。

### k6 配置

```javascript
export const options = {
  vus: 1,            // 1 个用户
  duration: '30s',   // 30 秒
};
```

### 适用场景

- 部署后快速验证
- CI/CD 中的基础检查
- 功能回归测试

## 15.7 场景选择指南

### 决策树

```
开始
 │
 ├─ 验证正常负载性能？
 │   └─ 负载测试
 │
 ├─ 找到性能极限？
 │   └─ 压力测试
 │
 ├─ 测试突发流量？
 │   └─ 峰值测试
 │
 ├─ 长时间运行？
 │   └─ 浸泡测试
 │
 ├─ 容量规划？
 │   └─ 容量测试
 │
 └─ 快速验证？
     └─ 烟雾测试
```

### 测试策略建议

1. **开发阶段**：烟雾测试
2. **功能测试**：负载测试
3. **性能优化**：压力测试
4. **上线前**：峰值测试 + 容量测试
5. **生产环境**：浸泡测试

---

**下一章**：[第16章：实战案例一：RESTful API 测试](./16-实战案例-RESTful-API.md)

